<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>èª°æ˜¯è‡¥åº• - èª²å ‚æ•™å­¸å°ˆç”¨ç‰ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; text-align: center; padding: 20px; background: #f8f9fa; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #007bff; margin-bottom: 25px; }
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; transition: border-color 0.3s; }
        input:focus { border-color: #007bff; outline: none; }
        button { width: 100%; background: #007bff; color: white; border: none; padding: 15px; font-size: 18px; border-radius: 10px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        button:hover { background: #0056b3; }
        #gameArea { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .card { border: 3px dashed #007bff; padding: 50px 20px; margin: 20px auto; background: #e7f1ff; border-radius: 15px; cursor: pointer; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .hidden { display: none; }
        .word-text { font-size: 36px; color: #dc3545; margin: 0; }
        .hint { color: #888; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ•µï¸ èª°æ˜¯è‡¥åº• - ç™¼ç‰Œç³»çµ±</h2>
    
    <div class="input-group">
        <label>1. æˆ¿é–“è™Ÿç¢¼ (è€å¸«çµ¦çš„æ•¸å­—)</label>
        <input type="number" id="roomCode" placeholder="ä¾‹å¦‚ï¼š102">
    </div>

    <div class="input-group">
        <label>2. ç¾å ´ç¸½çµ„æ•¸ (4-6)</label>
        <input type="number" id="totalGroups" value="6" min="1">
    </div>

    <div class="input-group">
        <label>3. ä½ çš„çµ„åˆ¥ (ä½ æ˜¯ç¬¬å¹¾çµ„ï¼Ÿ)</label>
        <input type="number" id="groupNum" placeholder="ä¾‹å¦‚ï¼š1">
    </div>

    <button onclick="startGame()">æŸ¥çœ‹æœ¬çµ„å¡ç‰Œ</button>

    <div id="gameArea" class="hidden">
        <h3 id="displayGroup">ç¬¬ X çµ„</h3>
        <div class="card" onclick="toggleCard()">
            <span id="instruction">é»æ“Šç¿»ç‰Œ ğŸ‘†</span>
            <h1 id="word" class="word-text hidden">è¼‰å…¥ä¸­...</h1>
        </div>
        <p class="hint">çœ‹éå¾Œè«‹å†æ¬¡é»æ“Šå¡ç‰Œéš±è—ï¼Œå‹¿è®“ä»–äººçœ‹è¦‹ï¼</p>
    </div>
</div>

<script>
    // å·²è‡ªå‹•å¡«å…¥æ‚¨çš„ Google CSV é€£çµ
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRXr-NxRpudrsU6BBpxKN4tOGZ5YmH_m4e1Fpcq1BvQyXjqO7wIhtVk3jRBpDQFKQpmmluUrbNfiDfm/pub?gid=0&single=true&output=csv';

    // ç°¡å–®çš„é›œæ¹Šå‡½å¼ï¼Œç¢ºä¿éš¨æ©Ÿæ€§èˆ‡å…¬å¹³æ€§
    function hash(str) {
        let h = 0;
        for (let i = 0; i < str.length; i++) {
            h = Math.imul(31, h) + str.charCodeAt(i) | 0;
        }
        return Math.abs(h);
    }

    async function startGame() {
        const roomCode = document.getElementById('roomCode').value;
        const groupNum = parseInt(document.getElementById('groupNum').value);
        const totalGroups = parseInt(document.getElementById('totalGroups').value);
        
        if (!roomCode || !groupNum || !totalGroups) {
            alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');
            return;
        }
        if (groupNum > totalGroups) {
            alert('éŒ¯èª¤ï¼šçµ„åˆ¥ä¸å¯å¤§æ–¼ç¸½çµ„æ•¸');
            return;
        }

        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            
            // è§£æ CSV å…§å®¹ï¼Œéæ¿¾æ‰æ¨™é¡Œåˆ—
            const rows = data.split('\n')
                             .map(row => row.split(','))
                             .filter(r => r.length >= 2 && !r[0].includes("å¹³æ°‘"));

            if (rows.length === 0) {
                alert('è©¦ç®—è¡¨ä¸­æ²’æœ‰æ‰¾åˆ°è©å½™è³‡æ–™');
                return;
            }

            // ä½¿ç”¨æˆ¿é–“è™Ÿç¢¼è¨ˆç®—ç¨®å­
            const seed = hash(roomCode.toString());
            
            // æ±ºå®šæŠ½å“ªä¸€çµ„è©å½™
            const pairIndex = seed % rows.length;
            const [civWord, spyWord] = rows[pairIndex].map(w => w.trim());

            // æ±ºå®šå“ªä¸€çµ„æ˜¯è‡¥åº• (ä½¿ç”¨äºŒæ¬¡é›œæ¹Šå¢åŠ éš¨æ©Ÿåº¦)
            const spyGroup = (hash(seed.toString()) % totalGroups) + 1;

            // é¡¯ç¤ºçµæœ
            document.getElementById('displayGroup').innerText = `ç¬¬ ${groupNum} çµ„`;
            document.getElementById('word').innerText = (groupNum === spyGroup) ? spyWord : civWord;
            
            // é‡è¨­å¡ç‰Œç‹€æ…‹
            document.getElementById('word').classList.add('hidden');
            document.getElementById('instruction').classList.remove('hidden');
            document.getElementById('gameArea').classList.remove('hidden');

        } catch (error) {
            alert('è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– CSV é€£çµã€‚');
            console.error(error);
        }
    }

    function toggleCard() {
        const word = document.getElementById('word');
        const inst = document.getElementById('instruction');
        if (word.classList.contains('hidden')) {
            word.classList.remove('hidden');
            inst.classList.add('hidden');
        } else {
            word.classList.add('hidden');
            inst.classList.remove('hidden');
        }
    }
</script>

</body>
</html>
