<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å•¥äººè¬›ç™½è³Š</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* å®šç¾©ä¸‰ç¨®é…è‰²è®Šæ•¸ */
        :root { 
            --primary: #007bff; --bg: #f4f7f9; --container-bg: #ffffff; 
            --text-main: #222222; --text-sub: #555555; --text-mean: #777777;
            --card-border: #007bff; --hint-bg: #fff9db; --hint-text: #856404;
            --rule-text: #888888;
        }

        /* å¤¢å¹»ç²‰ */
        body.theme-pink { 
            --primary: #d63384; --bg: #fff0f6; --container-bg: #ffffff; 
            --text-main: #444444; --text-sub: #666666; --text-mean: #888888;
            --card-border: #ff85c0; --hint-bg: #fff0f6; --hint-text: #a61e4d;
            --rule-text: #999999;
        }

        /* é«˜è²´é»ƒ */
        body.theme-yellow { 
            --primary: #e67e22; --bg: #fff9db; --container-bg: #ffffff; 
            --text-main: #443300; --text-sub: #665500; --text-mean: #887700;
            --card-border: #fab005; --hint-bg: #fff9db; --hint-text: #856404;
            --rule-text: #776622;
        }

        /* å¯§éœé»‘ */
        body.theme-black { 
            --primary: #4dabf7; --bg: #121212; --container-bg: #1e1e1e; 
            --text-main: #ffffff; --text-sub: #cccccc; --text-mean: #aaaaaa;
            --card-border: #4dabf7; --hint-bg: #2c2c2c; --hint-text: #ffd43b;
            --rule-text: #999999;
        }

        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); text-align: center; padding: 10px; margin: 0; transition: background 0.3s; }
        .container { max-width: 600px; margin: 0 auto; background: var(--container-bg); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); min-height: 85vh; display: flex; flex-direction: column; transition: background 0.3s; }
        
        .theme-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .theme-btn { padding: 8px 15px; font-size: 14px; border-radius: 20px; border: 1px solid #ddd; cursor: pointer; font-weight: bold; }
        .btn-pink { background: #ff85c0; color: white; }
        .btn-yellow { background: #fab005; color: #443300; }
        .btn-black { background: #333333; color: white; }

        h2 { color: var(--primary); margin-bottom: 25px; font-size: 28px; }
        .step-title { font-weight: bold; color: var(--text-sub); margin-bottom: 15px; font-size: 1.2em; }
        
        input { width: 85%; padding: 15px; font-size: 20px; border: 2px solid #ddd; border-radius: 12px; margin-bottom: 30px; text-align: center; background: var(--container-bg); color: var(--text-main); }

        .btn-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-bottom: 30px; }
        .btn-group button { padding: 12px 25px; font-size: 18px; border: 2px solid var(--primary); background: transparent; color: var(--primary); border-radius: 12px; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .btn-group button.active { background: var(--primary); color: #fff; }

        .hidden { display: none; }

        #resultCard { margin-top: 10px; padding: 40px 20px; border: 4px solid var(--card-border); border-radius: 20px; background: var(--container-bg); }
        .word-main { font-size: 52px; font-weight: 900; color: var(--text-main); margin: 0; line-height: 1.2; }
        .word-pron { font-size: 26px; color: var(--text-sub); margin: 12px 0; font-family: "Lucida Sans", sans-serif; }
        .word-mean { font-size: 20px; color: var(--text-mean); border-top: 1px solid #eee; margin-top: 20px; padding-top: 15px; }
        
        .hint-box { margin-top: 25px; padding: 20px; background: var(--hint-bg); border-radius: 15px; text-align: left; border-left: 5px solid var(--primary); }
        .hint-title { font-weight: bold; color: var(--hint-text); margin-bottom: 10px; font-size: 17px; }
        .hint-list { list-style: none; padding: 0; margin: 0; color: var(--text-sub); line-height: 1.8; font-size: 16px; }
        
        .locked-msg { margin-top: 20px; color: #dc3545; font-weight: bold; font-size: 0.9em; }
        .score-rules { margin-top: 20px; padding: 15px; text-align: left; font-size: 13px; color: var(--rule-text); border-top: 1px dashed #ccc; }
        .score-rules b { color: var(--primary); }
        
        .warning-text { color: #888; font-size: 14px; margin-top: 20px; }

        /* è€å¸«æ¨¡å¼å°ˆç”¨æ¨£å¼ */
        .teacher-view { text-align: left; }
        .teacher-info { padding: 15px; border: 2px solid var(--primary); border-radius: 15px; margin-top: 20px; }
        .spy-highlight { color: #dc3545; font-size: 1.5em; font-weight: bold; }
        .word-box { margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 10px; }

        footer { margin-top: auto; padding-top: 40px; font-size: 12px; color: #bbb; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10deg); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="theme-pink">

<div class="container">
    <div class="theme-selector">
        <div class="theme-btn btn-pink" onclick="setTheme('pink')">å¤¢å¹»ç²‰</div>
        <div class="theme-btn btn-yellow" onclick="setTheme('yellow')">é«˜è²´é»ƒ</div>
        <div class="theme-btn btn-black" onclick="setTheme('black')">å¯§éœé»‘</div>
    </div>

    <div id="setupArea">
        <h2>ğŸ•µï¸ å•¥äººè¬›ç™½è³Š-ç™¼ç‰Œç³»çµ±</h2>
        <div id="step1">
            <div class="step-title">ç¬¬ä¸€æ­¥ï¼šè¼¸å…¥å…±åŒè™Ÿç¢¼</div>
            <input type="text" id="roomCode" placeholder="åƒè¬›ï¼š0121" oninput="checkTeacherMode(this.value)">
        </div>
        <div id="step2">
            <div class="step-title">ç¬¬äºŒæ­¥ï¼šå’±æ”ç¸½åˆ†åšå¹¾çµ„ï¼Ÿ</div>
            <div class="btn-group">
                <button onclick="setTotalGroups(4)" id="total4">å…± 4 çµ„</button>
                <button onclick="setTotalGroups(5)" id="total5">å…± 5 çµ„</button>
                <button onclick="setTotalGroups(6)" id="total6">å…± 6 çµ„</button>
            </div>
        </div>
        <div id="step3" class="hidden">
            <div class="step-title">ç¬¬ä¸‰æ­¥ï¼šä½ æ˜¯ç¬¬å¹¾çµ„ï¼Ÿ</div>
            <div class="btn-group" id="myGroupBtns"></div>
        </div>
        <div class="warning-text">â€»è«‹æ³¨æ„ï¼šçƒç™½è¨­å®šæœƒå®³éŠæˆ²è¢‚ç•¶é€²è¡Œ</div>
    </div>

    <div id="resultArea" class="hidden fade-in">
        <div id="resultCard">
            <div class="word-main" id="displayWord">...</div>
            <div class="word-pron" id="displayPron">...</div>
            <div class="word-mean" id="displayMean">...</div>
        </div>
        <div class="hint-box">
            <div class="hint-title">ğŸ’¡ ä½ æ¯‹é€šè¬›äº†å‚·éæ˜é¡¯ï¼Œä½ æœƒä½¿æŒ‰å‘¢è¬›ï¼š</div>
            <ul class="hint-list">
                <li>(1) é€™æ¬¾æ±è¥¿/é€™é …ä»£èªŒå¤§éƒ¨åˆ†â€¦</li>
                <li>(2) å’±æœƒç”¨ä¼Š/é€™ä¾†â€¦</li>
                <li>(3) ä¼Šçš„è‰²è‡´æ˜¯â€¦</li>
                <li>(4) é€™çœ‹èµ·ä¾†/æ‘¸èµ·ä¾†â€¦</li>
                <li>(5) å•¥ç‰©æ™‚é™£/ä½‡ä½—è¼ƒçœ‹æœƒè‘—â€¦</li>
            </ul>
        </div>
        <div class="score-rules">
            <b>âš–ï¸ ç®—åˆ†æ–¹å¼ï¼š</b><br>
            (1) è¬›ç™½è³Šçš„è‹¥äºˆäººæ è‘—ï¼Œè¬›è€å¯¦è©±çš„æ”åŠ 1åˆ† â†’ é‡æŠ½é¡Œ<br>
            (2) 3è¼ªäº†å¾Œï¼Œè¬›ç™½è³Šè‹¥ç„¡äºˆäººæ è‘—ï¼Œè¬›ç™½è³Šçš„åŠ 2åˆ† â†’ é‡æŠ½é¡Œ
        </div>
        <div class="locked-msg">âš ï¸ å¡ç‰Œå·²é–å®šï¼Œè«‹å„çµ„é–‹å§‹è¨è«–</div>
    </div>

    <div id="teacherArea" class="hidden fade-in teacher-view">
        <h2 style="color:#dc3545">ğŸ‘ï¸ ä¸Šå¸ä¹‹çœ¼ - è€å¸«ç›£æ§æ¨¡å¼</h2>
        <div class="step-title">1. è¼¸å…¥å­¸ç”Ÿæ­£åœ¨ç”¨çš„è™Ÿç¢¼</div>
        <input type="number" id="tRoomCode" placeholder="å…±åŒè™Ÿç¢¼">
        <div class="step-title">2. å…¨ç­åˆ†åšå¹¾çµ„ï¼Ÿ</div>
        <div class="btn-group">
            <button onclick="calculateTeacherResult(4)">4 çµ„</button>
            <button onclick="calculateTeacherResult(5)">5 çµ„</button>
            <button onclick="calculateTeacherResult(6)">6 çµ„</button>
        </div>
        
        <div id="teacherResult" class="hidden">
            <div class="teacher-info">
                <div>ä»Šæ—¥è‡¥åº•çµ„åˆ¥ï¼š<span id="tSpyGroup" class="spy-highlight">?</span></div>
                <hr>
                <div class="word-box">
                    <b style="color:#dc3545">ğŸš¨ è‡¥åº• (è¬›ç™½è³Š) çœ‹åˆ°çš„ç‰Œï¼š</b>
                    <div id="tSpyWord" style="font-size:1.2em; font-weight:bold">...</div>
                </div>
                <div class="word-box">
                    <b style="color:#007bff">ğŸ‘¤ å¹³æ°‘ (è¬›è€å¯¦è©±) çœ‹åˆ°çš„ç‰Œï¼š</b>
                    <div id="tCivWord" style="font-size:1.2em; font-weight:bold">...</div>
                </div>
            </div>
            <button onclick="location.reload()" style="margin-top:20px; border-color:#888; color:#888">é›¢é–‹è€å¸«æ¨¡å¼</button>
        </div>
    </div>

    <footer>
        éŠæˆ²ç™¼æƒ³ï¼šIÃ´nn Ã€n-tsiong &nbsp;|&nbsp; æ”¯æ´ï¼šGemini
    </footer>
</div>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRXr-NxRpudrsU6BBpxKN4tOGZ5YmH_m4e1Fpcq1BvQyXjqO7wIhtVk3jRBpDQFKQpmmluUrbNfiDfm/pub?gid=0&single=true&output=csv';
    
    let state = { roomCode: '', totalGroups: 0 };

    function setTheme(themeName) { document.body.className = 'theme-' + themeName; }

    function hash(str) {
        let h = 0;
        for (let i = 0; i < str.length; i++) {
            h = Math.imul(31, h) + str.charCodeAt(i) | 0;
        }
        return Math.abs(h);
    }

    // æª¢æŸ¥è€å¸«æ¨¡å¼è§¸ç™¼ç¢¼
    function checkTeacherMode(val) {
        if (val === 'eyeofprovidence') {
            document.getElementById('setupArea').classList.add('hidden');
            document.getElementById('teacherArea').classList.remove('hidden');
            document.body.className = 'theme-black'; // è‡ªå‹•åˆ‡æ›å¯§éœé»‘ï¼Œå¢åŠ å°ˆæ¥­æ„Ÿ
        }
    }

    function setTotalGroups(n) {
        state.roomCode = document.getElementById('roomCode').value;
        if (!state.roomCode) { alert("è«‹å…ˆè¼¸å…¥è™Ÿç¢¼"); return; }
        state.totalGroups = n;
        [4,5,6].forEach(num => {
            const btn = document.getElementById('total' + num);
            if(btn) btn.classList.remove('active');
        });
        document.getElementById('total' + n).classList.add('active');
        const btnContainer = document.getElementById('myGroupBtns');
        btnContainer.innerHTML = '';
        for (let i = 1; i <= n; i++) {
            const btn = document.createElement('button');
            btn.innerText = `ç¬¬ ${i} çµ„`;
            btn.onclick = () => showCard(i);
            btnContainer.appendChild(btn);
        }
        document.getElementById('step3').classList.remove('hidden');
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function showCard(groupIndex) {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            const rows = data.split('\n').map(row => row.split(',')).filter(r => r.length >= 6 && !r[0].includes("å¹³æ°‘"));
            const seed = hash(state.roomCode.toString());
            const totalScenarios = rows.length * 2;
            const scenarioIndex = seed % totalScenarios;
            const rowIndex = scenarioIndex % rows.length;
            const rowData = rows[rowIndex];
            const isFlipped = scenarioIndex >= rows.length;
            const spyGroup = (hash(seed.toString()) % state.totalGroups) + 1;

            let word, pron, mean;
            if (groupIndex === spyGroup) {
                const offset = isFlipped ? 0 : 3;
                word = rowData[offset].trim(); pron = rowData[offset + 1].trim(); mean = rowData[offset + 2].trim();
            } else {
                const offset = isFlipped ? 3 : 0;
                word = rowData[offset].trim(); pron = rowData[offset + 1].trim(); mean = rowData[offset + 2].trim();
            }
            document.getElementById('displayWord').innerText = word;
            document.getElementById('displayPron').innerText = pron;
            document.getElementById('displayMean').innerText = "è¯èªï¼š" + mean;
            document.getElementById('setupArea').classList.add('hidden');
            document.getElementById('resultArea').classList.remove('hidden');
        } catch (error) { alert('è®€å–å¤±æ•—'); }
    }

    // è€å¸«ç›£æ§æ¨¡å¼è¨ˆç®—
    async function calculateTeacherResult(numGroups) {
        const tCode = document.getElementById('tRoomCode').value;
        if (!tCode) { alert("è«‹è¼¸å…¥è™Ÿç¢¼"); return; }
        
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            const rows = data.split('\n').map(row => row.split(',')).filter(r => r.length >= 6 && !r[0].includes("å¹³æ°‘"));
            
            const seed = hash(tCode.toString());
            const totalScenarios = rows.length * 2;
            const scenarioIndex = seed % totalScenarios;
            const rowIndex = scenarioIndex % rows.length;
            const rowData = rows[rowIndex];
            const isFlipped = scenarioIndex >= rows.length;
            const spyGroup = (hash(seed.toString()) % numGroups) + 1;

            // å–å¾—è‡¥åº•ç‰Œ
            const sOff = isFlipped ? 0 : 3;
            const sW = `${rowData[sOff].trim()} (${rowData[sOff+1].trim()}) - ${rowData[sOff+2].trim()}`;
            
            // å–å¾—å¹³æ°‘ç‰Œ
            const cOff = isFlipped ? 3 : 0;
            const cW = `${rowData[cOff].trim()} (${rowData[cOff+1].trim()}) - ${rowData[cOff+2].trim()}`;

            document.getElementById('tSpyGroup').innerText = `ç¬¬ ${spyGroup} çµ„`;
            document.getElementById('tSpyWord').innerText = sW;
            document.getElementById('tCivWord').innerText = cW;
            document.getElementById('teacherResult').classList.remove('hidden');
        } catch (error) { alert('è¨ˆç®—å¤±æ•—'); }
    }
</script>

</body>
</html>
