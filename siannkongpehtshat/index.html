<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å•¥äººè¬›ç™½è³Š - èªæ–‡æ•™å­¸ç‰ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --primary: #007bff; --spy: #dc3545; --bg: #f4f7f9; --hint-bg: #fff9db; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); text-align: center; padding: 20px; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); min-height: 80vh; display: flex; flex-direction: column; }
        
        h2 { color: var(--primary); margin-bottom: 25px; font-size: 28px; }
        .step-title { font-weight: bold; color: #555; margin-bottom: 15px; font-size: 1.1em; }
        
        /* è¼¸å…¥æ¡†ç¾åŒ– */
        input#roomCode { width: 85%; padding: 15px; font-size: 20px; border: 2px solid #ddd; border-radius: 12px; margin-bottom: 30px; text-align: center; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-bottom: 30px; }
        button { padding: 12px 25px; font-size: 18px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 12px; cursor: pointer; transition: 0.2s; font-weight: bold; }
        button.active { background: var(--primary); color: white; }
        button:hover { background: #f0f7ff; }

        /* éš±è—å€å¡Š */
        .hidden { display: none; }

        /* å¡ç‰Œç¾åŒ– */
        #resultCard { margin-top: 10px; padding: 40px 20px; border: 4px solid var(--primary); border-radius: 20px; background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        .word-main { font-size: 52px; font-weight: 900; color: #222; margin: 0; line-height: 1.2; }
        .word-pron { font-size: 26px; color: #555; margin: 12px 0; font-family: "Lucida Sans", sans-serif; }
        .word-mean { font-size: 20px; color: #777; border-top: 1px solid #eee; margin-top: 20px; padding-top: 15px; }
        
        /* èªªè©±æç¤ºå€ */
        .hint-box { margin-top: 25px; padding: 20px; background: var(--hint-bg); border-radius: 15px; text-align: left; border-left: 5px solid #fab005; }
        .hint-title { font-weight: bold; color: #856404; margin-bottom: 10px; font-size: 17px; }
        .hint-list { list-style: none; padding: 0; margin: 0; color: #665c33; line-height: 1.8; font-size: 16px; }
        
        .locked-msg { margin-top: 20px; color: #dc3545; font-weight: bold; font-size: 0.9em; letter-spacing: 1px; }

        /* é å°¾ */
        footer { margin-top: auto; padding-top: 40px; font-size: 12px; color: #bbb; }

        /* å‹•ç•« */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10deg); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="setupArea">
        <h2>ğŸ•µï¸ å•¥äººè¬›ç™½è³Š-ç™¼ç‰Œç³»çµ±</h2>

        <div id="step1">
            <div class="step-title">æ­¥é©Ÿä¸€ï¼šè«‹è¼¸å…¥æˆ¿é–“è™Ÿç¢¼</div>
            <input type="number" id="roomCode" placeholder="ä¾‹å¦‚ï¼š0121" inputmode="numeric">
        </div>

        <div id="step2">
            <div class="step-title">æ­¥é©ŸäºŒï¼šå…¨ç­å…±æœ‰å¹¾çµ„ï¼Ÿ</div>
            <div class="btn-group">
                <button onclick="setTotalGroups(4)" id="total4">å…± 4 çµ„</button>
                <button onclick="setTotalGroups(5)" id="total5">å…± 5 çµ„</button>
                <button onclick="setTotalGroups(6)" id="total6">å…± 6 çµ„</button>
            </div>
        </div>

        <div id="step3" class="hidden">
            <div class="step-title">æ­¥é©Ÿä¸‰ï¼šä½ æ˜¯ç¬¬å¹¾çµ„ï¼Ÿ</div>
            <div class="btn-group" id="myGroupBtns"></div>
        </div>
    </div>

    <div id="resultArea" class="hidden fade-in">
        <div id="resultCard">
            <div class="word-main" id="displayWord">...</div>
            <div class="word-pron" id="displayPron">...</div>
            <div class="word-mean" id="displayMean">...</div>
        </div>

        <div class="hint-box">
            <div class="hint-title">ğŸ’¡ ä½ æ¯‹é€šè¬›äº†å‚·éæ˜é¡¯ï¼Œä½ æœƒä½¿æŒ‰å‘¢è¬›ï¼š</div>
            <ul class="hint-list">
                <li>(1) é€™æ¬¾æ±è¥¿/é€™é …ä»£èªŒå¤§éƒ¨åˆ†â€¦</li>
                <li>(2) å’±æœƒç”¨ä¼Š/é€™ä¾†â€¦</li>
                <li>(3) ä¼Šçš„è‰²è‡´æ˜¯â€¦</li>
                <li>(4) é€™çœ‹èµ·ä¾†/æ‘¸èµ·ä¾†â€¦</li>
                <li>(5) å•¥ç‰©æ™‚é™£è¼ƒçœ‹æœƒè‘—â€¦</li>
            </ul>
        </div>
        
        <div class="locked-msg">âš ï¸ å¡ç‰Œå·²é–å®šï¼Œè«‹å„çµ„é–‹å§‹è¨è«–</div>
    </div>

    <footer>
        éŠæˆ²ç™¼æƒ³ï¼šIÃ´nn Ã€n-tsiong &nbsp;|&nbsp; æ”¯æ´ï¼šGemini
    </footer>
</div>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRXr-NxRpudrsU6BBpxKN4tOGZ5YmH_m4e1Fpcq1BvQyXjqO7wIhtVk3jRBpDQFKQpmmluUrbNfiDfm/pub?gid=0&single=true&output=csv';
    
    let state = {
        roomCode: '',
        totalGroups: 0
    };

    function hash(str) {
        let h = 0;
        for (let i = 0; i < str.length; i++) {
            h = Math.imul(31, h) + str.charCodeAt(i) | 0;
        }
        return Math.abs(h);
    }

    function setTotalGroups(n) {
        state.roomCode = document.getElementById('roomCode').value;
        if (!state.roomCode) {
            alert("è«‹å…ˆè¼¸å…¥æˆ¿é–“è™Ÿç¢¼");
            return;
        }
        state.totalGroups = n;

        // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
        [4,5,6].forEach(num => {
            const btn = document.getElementById('total' + num);
            if(btn) btn.classList.remove('active');
        });
        document.getElementById('total' + n).classList.add('active');

        // å‹•æ…‹ç”Ÿæˆçµ„åˆ¥æŒ‰éˆ•
        const btnContainer = document.getElementById('myGroupBtns');
        btnContainer.innerHTML = '';
        for (let i = 1; i <= n; i++) {
            const btn = document.createElement('button');
            btn.innerText = `ç¬¬ ${i} çµ„`;
            btn.onclick = () => showCard(i);
            btnContainer.appendChild(btn);
        }

        document.getElementById('step3').classList.remove('hidden');
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function showCard(groupIndex) {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            
            // è§£æ CSV ä¸¦éæ¿¾æ¨™é¡Œ
            const rows = data.split('\n')
                             .map(row => row.split(','))
                             .filter(r => r.length >= 6 && !r[0].includes("å¹³æ°‘"));

            if (rows.length === 0) {
                alert('è©¦ç®—è¡¨ä¸­æ²’æœ‰æ‰¾åˆ°è©å½™è³‡æ–™');
                return;
            }

            const seed = hash(state.roomCode.toString());
            const pairIndex = seed % rows.length;
            const rowData = rows[pairIndex];

            // éš¨æ©Ÿæ±ºå®šè‡¥åº•
            const spyGroup = (hash(seed.toString()) % state.totalGroups) + 1;

            let word, pron, mean;
            if (groupIndex === spyGroup) {
                word = rowData[3].trim(); // D è‡¥åº•è©
                pron = rowData[4].trim(); // E è‡¥åº•ç™¼éŸ³
                mean = rowData[5].trim(); // F è‡¥åº•é‡‹ç¾©
            } else {
                word = rowData[0].trim(); // A å¹³æ°‘è©
                pron = rowData[1].trim(); // B å¹³æ°‘ç™¼éŸ³
                mean = rowData[2].trim(); // C å¹³æ°‘é‡‹ç¾©
            }

            // æ›´æ–°å…§å®¹
            document.getElementById('displayWord').innerText = word;
            document.getElementById('displayPron').innerText = pron;
            document.getElementById('displayMean').innerText = "è¯èªï¼š" + mean;

            // åˆ‡æ›ç•«é¢
            document.getElementById('setupArea').classList.add('hidden');
            document.getElementById('resultArea').classList.remove('hidden');
            document.body.style.background = "#dee2e6";

        } catch (error) {
            alert('è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·š');
            console.error(error);
        }
    }
</script>

</body>
</html>
